#!/bin/ash

BACKGROUNDS=`ls /usr/local/share/backgrounds/*.svg /usr/local/share/backgrounds/*.png /usr/local/share/backgrounds/*.jpg 2>/dev/null | sed s~.*/~~g`
while :; do
	CHOICE=`yad --title "Wallpaper setter" --window-icon=gtk-preferences --height=300 --list --no-headers --column=theme --print-column=1 --separator= -- "Solid color" $BACKGROUNDS`
	[ -z "$CHOICE" ] && break

	if [ "$CHOICE" = "Solid color" ]; then
		CHOICE=`yad --title "Wallpaper setter" --window-icon=gtk-preferences --height=300 --color`
		[ -z "$CHOICE" ] && break
		sed -i "s~^Exec=.*~Exec=swaybg -c \"${CHOICE}\"~" ~/.config/autostart/swaybg.desktop
	else
		sed -i "s~^Exec=.*~Exec=swaybg -i \"/usr/local/share/backgrounds/${CHOICE}\" -m stretch~" ~/.config/autostart/swaybg.desktop
	fi
	set_bg
done