#!/bin/bash

LOCALE_CB=
while read LOCALE; do
	LOCALE_CB="${LOCALE_CB} ${LOCALE}"
done < /usr/share/i18n/SUPPORTED

LOCALE=`yad --title=locale-set --height=480 --width=240 --list --column=:TEXT --column=:TEXT --hide-column=2 --no-headers --separator=' ' ${LOCALE_CB}`
[ $? -ne 0 ] && exit 1

LOCALE="${LOCALE% }"

yad --image=dialog-information --layer=overlay --edge=top --text="Setting locale to ${LOCALE}" --no-buttons --no-focus &
PID=$!

sed -i 's/^[^#]/# &/g' /etc/locale.gen
ELOCALE="${LOCALE/./\\.}"
sed -i "s~^# ${ELOCALE}\$~${LOCALE}~" /etc/locale.gen
locale-gen
update-locale "LANG=${LOCALE% *}"

kill $PID
