#!/bin/bash

. ~/.libinputrc

[ -z "$LIBINPUT_DEFAULT_TAP" ] && LIBINPUT_DEFAULT_TAP=1
[ -z "$LIBINPUT_DEFAULT_DRAG" ] && LIBINPUT_DEFAULT_DRAG=0
[ -z "$LIBINPUT_DEFAULT_DISABLE_WHILE_TYPING" ] && LIBINPUT_DEFAULT_DISABLE_WHILE_TYPING=0
[ -z "$LIBINPUT_DEFAULT_NATURAL_SCROLL" ] && LIBINPUT_DEFAULT_NATURAL_SCROLL=0
[ -z "$LIBINPUT_DEFAULT_ACCELERATION" ] && LIBINPUT_DEFAULT_ACCELERATION=0
[ -z "$LIBINPUT_DEFAULT_SCROLL_METHOD" ] && LIBINPUT_DEFAULT_SCROLL_METHOD=1
[ -z "$LIBINPUT_DEFAULT_ACCELERATION_PROFILE" ] && LIBINPUT_DEFAULT_ACCELERATION_PROFILE=1
[ -z "$LIBINPUT_DEFAULT_CLICK_METHOD" ] && LIBINPUT_DEFAULT_CLICK_METHOD=1
[ -z "$LIBINPUT_DEFAULT_MIDDLE_EMULATION" ] && LIBINPUT_DEFAULT_MIDDLE_EMULATION=0
[ -z "$LIBINPUT_DEFAULT_LEFT_HANDED" ] && LIBINPUT_DEFAULT_LEFT_HANDED=0

SCROLL_METHOD_CB=
if [ "$LIBINPUT_DEFAULT_SCROLL_METHOD" = 0 ]; then
	SCROLL_METHOD_CB="^No scrolling"
else
	SCROLL_METHOD_CB="No scrolling"
fi
if [ "$LIBINPUT_DEFAULT_SCROLL_METHOD" = 1 ]; then
	SCROLL_METHOD_CB="$SCROLL_METHOD_CB!^2 fingers"
else
	SCROLL_METHOD_CB="$SCROLL_METHOD_CB!2 fingers"
fi
if [ "$LIBINPUT_DEFAULT_SCROLL_METHOD" = 2 ]; then
	SCROLL_METHOD_CB="$SCROLL_METHOD_CB!^Edge"
else
	SCROLL_METHOD_CB="$SCROLL_METHOD_CB!Edge"
fi
if [ "$LIBINPUT_DEFAULT_SCROLL_METHOD" = 4 ]; then
	SCROLL_METHOD_CB="$SCROLL_METHOD_CB!^On button down"
else
	SCROLL_METHOD_CB="$SCROLL_METHOD_CB!On button down"
fi

ACCELERATION_CB=
for ACCEL in -1.0 -0.9 -0.8 -0.7 -0.6 -0.5 -0.4 -0.3 -0.2 -0.1 0 0.1 0.2 0.3 0.4 0.5 0.6 0.7 0.8 0.9 1.0; do
	if [ "$ACCEL" = "$LIBINPUT_DEFAULT_ACCELERATION" ]; then
		if [ -z "$ACCELERATION_CB" ]; then
			ACCELERATION_CB="^$ACCEL"
		else
			ACCELERATION_CB="$ACCELERATION_CB!^$ACCEL"
		fi
	elif [ -z "$ACCELERATION_CB" ]; then
		ACCELERATION_CB="$ACCEL"
	else
		ACCELERATION_CB="$ACCELERATION_CB!$ACCEL"
	fi
done

ACCELERATION_PROFILE_CB=
if [ "$LIBINPUT_DEFAULT_ACCELERATION_PROFILE" = 1 -o -z "$LIBINPUT_DEFAULT_ACCELERATION_PROFILE" ]; then
	ACCELERATION_PROFILE_CB="^Flat"
else
	ACCELERATION_PROFILE_CB="Flat"
fi
if [ "$LIBINPUT_DEFAULT_ACCELERATION_PROFILE" = 2 ]; then
	ACCELERATION_PROFILE_CB="$ACCELERATION_PROFILE_CB!^Adaptive"
else
	ACCELERATION_PROFILE_CB="$ACCELERATION_PROFILE_CB!Adaptive"
fi

CLICK_METHOD_CB=
if [ "$LIBINPUT_DEFAULT_CLICK_METHOD" = 0 ]; then
	CLICK_METHOD_CB="^None"
else
	CLICK_METHOD_CB="None"
fi
if [ "$LIBINPUT_DEFAULT_CLICK_METHOD" = 1 ]; then
	CLICK_METHOD_CB="$CLICK_METHOD_CB!^Button areas"
else
	CLICK_METHOD_CB="$CLICK_METHOD_CB!Button areas"
fi
if [ "$LIBINPUT_DEFAULT_CLICK_METHOD" = 2 ]; then
	CLICK_METHOD_CB="$CLICK_METHOD_CB!^Fingers"
else
	CLICK_METHOD_CB="$CLICK_METHOD_CB!Fingers"
fi

VALS=`
    yad --title=libinput-config \
        --window-icon=input-mouse-symbolic \
        --bool-fmt=1 \
        --form \
        --field="Tap to click:CHK" \
        --field="Tap and drag:CHK" \
        --field="Disable while typing:CHK" \
        --field="Natural scrolling:CHK" \
        --field="Scroll method:CB" \
        --field=Acceleration:CB \
        --field="Acceleration profile:CB" \
        --field="Click method:CB" \
        --field="Middle button emulation:CHK" \
        --field="Left-handed mode:CHK" \
        -- \
        $LIBINPUT_DEFAULT_TAP \
        $LIBINPUT_DEFAULT_DRAG \
        $LIBINPUT_DEFAULT_DISABLE_WHILE_TYPING \
        $LIBINPUT_DEFAULT_NATURAL_SCROLL \
        "$SCROLL_METHOD_CB" \
        "$ACCELERATION_CB" \
        "$ACCELERATION_PROFILE_CB" \
        "$CLICK_METHOD_CB" \
        $LIBINPUT_DEFAULT_MIDDLE_EMULATION \
        $LIBINPUT_DEFAULT_LEFT_HANDED
`
[ $? -ne 0 ] && exit

IFS='|' read LIBINPUT_DEFAULT_TAP LIBINPUT_DEFAULT_DRAG LIBINPUT_DEFAULT_DISABLE_WHILE_TYPING LIBINPUT_DEFAULT_NATURAL_SCROLL SCROLL_METHOD LIBINPUT_DEFAULT_ACCELERATION ACCELERATION_PROFILE CLICK_METHOD LIBINPUT_DEFAULT_MIDDLE_EMULATION LIBINPUT_DEFAULT_LEFT_HANDED <<< "$VALS"

case "$SCROLL_METHOD" in
"No scrolling") LIBINPUT_DEFAULT_SCROLL_METHOD=0 ;;
"2 fingers") LIBINPUT_DEFAULT_SCROLL_METHOD=1 ;;
Edge) LIBINPUT_DEFAULT_SCROLL_METHOD=2 ;;
"On button down") LIBINPUT_DEFAULT_SCROLL_METHOD=4 ;;
esac

case "$ACCELERATION_PROFILE" in
Flat) LIBINPUT_DEFAULT_ACCELERATION_PROFILE=1 ;;
Adapative) LIBINPUT_DEFAULT_ACCELERATION_PROFILE=2 ;;
esac

case "$CLICK_METHOD" in
None) LIBINPUT_DEFAULT_CLICK_METHOD=0 ;;
"Button areas") LIBINPUT_DEFAULT_CLICK_METHOD=1 ;;
Fingers) LIBINPUT_DEFAULT_CLICK_METHOD=2 ;;
esac

cat << EOF > ~/.libinputrc
LIBINPUT_DEFAULT_TAP=${LIBINPUT_DEFAULT_TAP}
LIBINPUT_DEFAULT_NATURAL_SCROLL=${LIBINPUT_DEFAULT_NATURAL_SCROLL}
LIBINPUT_DEFAULT_ACCELERATION=${LIBINPUT_DEFAULT_ACCELERATION}
LIBINPUT_DEFAULT_ACCELERATION_PROFILE=${LIBINPUT_DEFAULT_ACCELERATION_PROFILE}
LIBINPUT_DEFAULT_SCROLL_METHOD=${LIBINPUT_DEFAULT_SCROLL_METHOD}
LIBINPUT_DEFAULT_CLICK_METHOD=${LIBINPUT_DEFAULT_CLICK_METHOD}
LIBINPUT_DEFAULT_DRAG=${LIBINPUT_DEFAULT_DRAG}
LIBINPUT_DEFAULT_DISABLE_WHILE_TYPING=${LIBINPUT_DEFAULT_DISABLE_WHILE_TYPING}
LIBINPUT_DEFAULT_MIDDLE_EMULATION=${LIBINPUT_DEFAULT_MIDDLE_EMULATION}
LIBINPUT_DEFAULT_LEFT_HANDED=${LIBINPUT_DEFAULT_LEFT_HANDED}
EOF
